<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AACI Clinical Governance Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      padding: 20px;
    }
    .quiz-container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: none;
    }
    .question {
      margin-bottom: 20px;
    }
    .options label {
      display: block;
      margin: 5px 0;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid #ccc;
      transition: background 0.2s;
    }
    .options input {
      margin-right: 10px;
    }
    .correct {
      background-color: #c8e6c9;
      border-color: #4caf50;
    }
    .wrong {
      background-color: #ffcdd2;
      border-color: #f44336;
    }
    .disabled {
      pointer-events: none;
      opacity: 0.7;
    }
    .submit-btn, .start-btn {
      margin-top: 20px;
      padding: 12px 25px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .score {
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
    }
    #startScreen {
      max-width: 500px;
      margin: 100px auto;
      text-align: center;
    }
    #leaderboard {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>Welcome to the AACI Clinical Governance Quiz</h1>
    <p>Enter your name to start:</p>
    <input type="text" id="username" placeholder="Your Name" />
    <br><br>
    <button class="start-btn" onclick="startQuiz()">Start Quiz</button>
  </div>

  <div class="quiz-container" id="quizContainer">
    <h1>AACI Clinical Governance Quiz</h1>
    <form id="quizForm"></form>
    <button class="submit-btn" onclick="submitQuiz()">Submit</button>
    <div class="score" id="scoreDisplay"></div>
    <div id="leaderboard"></div>
  </div>

 <script>
  const quizData = [
    { question: "1. What is the primary objective of clinical governance?", options: ["Increasing hospital profits", "Ensuring patient safety and quality", "Reducing staff workload", "Expanding hospital facilities"], answer: 1 },
    { question: "2. Which of the following is a pillar of clinical governance?", options: ["Marketing strategy", "Risk management", "Bed capacity", "Staff salary review"], answer: 1 },
    { question: "3. Clinical audit is used to:", options: ["Manage hospital finances", "Evaluate patient feedback", "Improve clinical practice", "Conduct staff meetings"], answer: 2 },
    { question: "4. Which is an example of clinical risk?", options: ["Equipment failure", "High staff turnover", "Budget reduction", "Policy change"], answer: 0 },
    { question: "5. What does EBP stand for?", options: ["Electronic Bed Processing", "Evidence-Based Practice", "Emergency Backup Plan", "Efficient Budget Planning"], answer: 1 },
    { question: "6. Which activity is part of quality improvement?", options: ["Staff vacation planning", "Clinical audit", "Marketing campaigns", "Facility expansion"], answer: 1 },
    { question: "7. Root Cause Analysis is used for:", options: ["Promoting staff", "Finding cause of adverse events", "Buying equipment", "Budgeting"], answer: 1 },
    { question: "8. Patient feedback is primarily used to:", options: ["Punish staff", "Market the hospital", "Improve patient care", "Increase revenue"], answer: 2 },
    { question: "9. Clinical governance helps in:", options: ["Reducing legal costs", "Improving patient outcomes", "Building new hospitals", "Staff retirement"], answer: 1 },
    { question: "10. What ensures healthcare decisions are based on best evidence?", options: ["EBP", "Marketing", "Finance team", "HR reports"], answer: 0 },
    { question: "11. Key part of risk management in hospitals:", options: ["Hiring celebrities", "Patient safety protocols", "Promoting products", "Adding cafes"], answer: 1 },
    { question: "12. Clinical effectiveness means:", options: ["Using the cheapest treatment", "Doing what always worked", "Providing best outcomes", "Following old rules"], answer: 2 },
    { question: "13. Incident reporting systems are used to:", options: ["Blame staff", "Improve processes", "Hide errors", "Train receptionists"], answer: 1 },
    { question: "14. One method to assess healthcare quality:", options: ["Staff gossip", "Audits", "Financial profit", "Social media"], answer: 1 },
    { question: "15. Clinical governance promotes:", options: ["Fear among staff", "Transparency and improvement", "Strict discipline", "Short-term goals"], answer: 1 }
  ];

  let username = "";
  let answers = Array(quizData.length).fill(null);
  let locked = Array(quizData.length).fill(false);

  function startQuiz() {
    username = document.getElementById('username').value.trim();
    if (!username) return alert("Please enter your name!");
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('quizContainer').style.display = 'block';
    buildQuiz();
  }

  function buildQuiz() {
    const quizForm = document.getElementById('quizForm');
    quizData.forEach((q, index) => {
      const div = document.createElement('div');
      div.classList.add('question');
      const qText = document.createElement('p');
      qText.innerHTML = `<strong>${q.question}</strong>`;
      div.appendChild(qText);

      const opts = document.createElement('div');
      opts.classList.add('options');
      q.options.forEach((opt, i) => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="radio" name="q${index}" value="${i}"> ${opt}`;
        label.onclick = () => {
          if (!locked[index]) {
            checkAnswer(index, i, label);
            locked[index] = true;
            [...opts.children].forEach(child => {
              child.classList.add('disabled');
              child.querySelector('input').disabled = true;
            });
          }
        };
        opts.appendChild(label);
      });

      div.appendChild(opts);
      quizForm.appendChild(div);
    });
  }

  function checkAnswer(qIndex, selected, labelElement) {
    const correct = quizData[qIndex].answer;
    if (selected === correct) {
      labelElement.classList.add('correct');
    } else {
      labelElement.classList.add('wrong');
      const parent = labelElement.parentElement;
      [...parent.children].forEach(label => {
        const input = label.querySelector('input');
        if (parseInt(input.value) === correct) {
          label.classList.add('correct');
        }
      });
    }
    answers[qIndex] = selected;
  }

  function submitQuiz() {
    let score = 0;
    answers.forEach((ans, i) => {
      if (ans === quizData[i].answer) score++;
    });
    document.getElementById("scoreDisplay").textContent = `You scored ${score} out of ${quizData.length}`;
    saveToLeaderboard(username, score);
    showLeaderboard();
  }

  function saveToLeaderboard(name, score) {
  fetch('https://script.google.com/macros/s/AKfycbx2Byi0H2miCEa2qYSjfgG2ZtFzHZcQeLJOntbyGl8Ds_Ny9e4m9lEKL4P4sCd-yPJXgg/exec', {
    method: 'POST',
    mode: 'no-cors', // Required for Google Apps Script without CORS headers
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ name, score })
  }).then(() => {
    showLeaderboard(); // Fetch after saving
  });
}

function showLeaderboard() {
  fetch('https://script.google.com/macros/s/AKfycbx2Byi0H2miCEa2qYSjfgG2ZtFzHZcQeLJOntbyGl8Ds_Ny9e4m9lEKL4P4sCd-yPJXgg/exec')
    .then(res => res.json())
    .then(data => {
      let html = '<h2>Leaderboard</h2><ul>';
      data.forEach(entry => {
        html += `<li>${entry.name}: ${entry.score}</li>`;
      });
      html += '</ul>';
      document.getElementById('leaderboard').innerHTML = html;
    })
    .catch(err => {
      console.error("Failed to load leaderboard:", err);
      document.getElementById('leaderboard').innerHTML = '<p style="color:red;">Unable to load leaderboard.</p>';
    });
}
</script>
</body>
</html>
